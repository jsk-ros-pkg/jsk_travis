# generated by `./generate_action_config.py indigo kinetic melodic noetic`
# jsk_travis
on: [push, pull_request]

env:
  TEST_VAR1: true
  TEST_VAR2: false

jobs:
  melodic:
    runs-on: ubuntu-latest
    name: melodic

    container: jskrobotics/ros-ubuntu:18.04

    steps:
      - name: Install latest git ( use sudo for ros-ubuntu, remove sudo for ubuntu container), checkout@v3.0.2 uses REST API for git<2.18, which removes .git folder and does not checkout .travis submodules
        run: sudo apt-get update && sudo apt-get install -y software-properties-common && sudo apt-get update && sudo add-apt-repository -y ppa:git-core/ppa && sudo apt-get update && sudo apt-get install -y git
      - name: work around permission issue  # https://github.com/actions/checkout/issues/760#issuecomment-1097501613
        run: |
          set -x
          export USER=$(whoami)
          git config --global --add safe.directory $GITHUB_WORKSPACE || echo "OK" # Show 'could not lock config file /github/home/.gitconfig: Permission denied', but it is ok
          sudo mkdir -p /__w/
          sudo chmod 777 -R /__w/
          sudo chown -R $USER $HOME
      - name: Checkout
        uses: actions/checkout@v3.0.2
      - name: Run jsk_travis
        uses: ./
        with:
          ADDITIONAL_ENV_TO_DOCKER: 'TEST_VAR1 TEST_VAR2'
          ROS_DISTRO : melodic
